# Mesh File Format Specification (.mesh)

This document goes over the custom mesh file format used internally by the Seed Engine. This format is based off of the syntax used in the .obj file format, with some extra options built in. All data for a mesh must be loaded from a standard format into a .mesh file before it can be loaded in-game.

## Syntax

Like .obj files, .mesh files store various attributes of each vertex on individual lines. This data is passed into the engine to generate a mesh at runtime. The following attributes are used:

| Attribute | Identifier | Values | Required | Requires Attribute |
|:---------:|:----------:|:------:|:--------:|:------------------:|
| Position | p | 3 | Yes | None |
| Normal | n | 3 | Yes | None |
| Primary Color | c0 | 4 | No | None |
| Secondary Color | c1 | 4 | No | Primary Color |
| UV Channel 0 | u0 | 2 | Yes | None |
| UV Channel 1 | u1 | 2 | No | UV Channel 0 |
| UV Channel 2 | u2 | 2 | No | UV Channel 1 |
| UV Channel 3 | u3 | 2 | No | UV Channel 2 |
| UV Channel 4 | u4 | 2 | No | UV Channel 3 |
| UV Channel 5 | u5 | 2 | No | UV Channel 4 |
| UV Channel 6 | u6 | 2 | No | UV Channel 5 |
| UV Channel 7 | u7 | 2 | No | UV Channel 6 |
| Face | f | 3 | Yes | Vertex Indices |

The following rules are followed strictly in each file:

- Each line starts with an identifier.
- Each identifier is followed by a comma-seperated list of values.
- All attribute values, excluding position, should be normalized.
- The number of values should exaclty match the number described in the above table.
- If an attribute is present for one vertex, it must be present for all vertices.
- A one-to-one mapping of each attribute to a vertex is required.
- Any attribute that requires another, such as `UV Channel 1`, may only be present along with that required attribute (in this case `UV Channel 0`).
- Faces are built from a collection of 3 vertices to form a triangle.
- All meshes should have at least one face. As such, 3 vertices are the required minimum by proxy.
- Vertices are indexed by line. As such, the first position written attaches to vertex 0, the first normal to vertex 0, etc..

## Properties

In addition to storing vertex data, .mesh files also support the inclusion of mesh properties. These properties are included at the top of the file in the following syntax:

```
[property]=value
```

Some examples of properties include the name of the mesh ([name]), the materials of the mesh ([mat0], [mat1], ...), and the draw type ([type]). Custom properties may be used, and can be referenced by name from a script or code.

### Built-in Properties

Several properties are supported by the engine by default. The following should be included in all .mesh files:

- name - The name of the mesh.
- mat0 - The material at index 0 of this mesh. Set this equal to DEFAULT to use the default engine material.
- mat*n* - The material at index *n* of this mesh. Example: mat5
- type - The type of mesh this is. This value should be set to either STATIC or SKELETAL.

## Comments

While .mesh files are normally generated by the software, they are designed to be human readable. As such, single line comments are supported. To start a comment, simply use the '#' character:

```ini
...
p 0.0, 2.1, -3.1 # This is a comment!
...
```

Multi-line comments are not supported as this is a line based format.

## Whitespace

Excluding line endings, whitespace is ignored when parsing this file format. However, excess whitespace should be avoided to prevent bloating the file size.

## Example

The following is an example of a simple quad mesh stored in a .mesh file:

```ini
# Example Quad Mesh
# Properties
[name]=Quad
[mat0]=DEFAULT
[type]=STATIC
# Attributes

# Vertex Positions
p -1.0, -1.0, 0.0 # This position is in the form: p <x: -1.0>, <y: -1.0>, <z: 0.0>
p 1.0, -1.0, 0.0 # The positions are indexed in the order they are added.
p 1.0, 1.0, 0.0 # This position is at index 2
p -1.0, 1.0, 0.0
# Vertex Normals
n 0.0, 0.0, 1.0 # Normals should be represented by a unit vector in the form n <x> <y> <z>
n 0.0, 0.0, 1.0
n 0.0, 0.0, 1.0
n 0.0, 0.0, 1.0
# Primary Vertex Colors
c0 0.0, 0.0, 0.0, 0.0 # The default vertex color should be black to avoid unexpected behaviors
c0 0.0, 0.0, 0.0, 0.0 # Colors use the format c0 <r> <g> <b> <a>
c0 0.0, 0.0, 0.0, 0.0 
c0 0.0, 0.0, 0.0, 0.0 
# Vertex UV Mapping 0
u0 0.0, 0.0 # Each UV attribute mapps a vertex to a point in UV space
u0 0.0, 1.0 # These values are store in the format u0 <u> <v>
u0 1.0, 1.0
u0 1.0, 0.0
# Faces
f 0, 1, 2 # This builds a triangle from the vertices at indices 0, 1, and 2
f 0, 2, 3
```

The above data matches what is found in [`quad.mesh`](https://github.com/ConficturaStudios/seed-engine/blob/master/core/data/quad.mesh) in the core data folder.